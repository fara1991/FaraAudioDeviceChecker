# FaraDeviceChecker

Windowsシステム上のオーディオデバイスの状態を診断し、ドライバーの問題を特定するためのC#コンソールアプリケーションです。

## 概要

このツールはWMI（Windows Management Instrumentation）を使用して、システム内のオーディオデバイスを検出し、以下の情報を提供します：

- デバイスの動作状態
- ドライバーのバージョンと日付
- 問題の診断と推奨事項
- デバイス統計情報

## 特徴

- **非破壊的診断**: デバイスの状態をチェックするのみで、システムを変更しません
- **詳細な分析**: 各デバイスの問題を具体的に特定
- **色分け表示**: 正常、注意、エラーを視覚的に区別
- **統計情報**: システム全体の概要を提供
- **具体的な推奨事項**: 問題解決のための手順を案内

## システム要件

- **OS**: Windows Vista以降
- **Framework**: .NET 6.0以降
- **権限**: 通常のユーザー権限で実行可能
- **依存関係**: System.Management NuGetパッケージ

## インストール

### 1. プロジェクトの作成

```bash
# Visual Studioで新しいConsole Appプロジェクトを作成
# Project Type: Console App
# Framework: .NET 6.0以降
```

### 2. NuGetパッケージの追加

```xml
<!-- .csprojファイルに追加 -->
<PackageReference Include="System.Management" Version="7.0.2" />
<SupportedOSPlatform>windows</SupportedOSPlatform>
```

または

```bash
# パッケージマネージャーコンソールで実行
Install-Package System.Management
```

### 3. ソースコードの配置

提供されたC#コードをProgram.csに配置してビルドします。

## 使用方法

### 基本的な実行

```bash
# コマンドプロンプトまたはPowerShellで実行
FaraAudioDriverChecker.exe
```

### 実行例

```
=== Audioドライバー状態チェッカー ===

検出されたAudioデバイス数: 12

デバイス名: Realtek High Definition Audio
製造元: Realtek
デバイスID: HDAUDIO\FUNC_01&VEN_10EC&DEV_0887...
ドライバーバージョン: 6.0.9374.1
ドライバー日付: 2023/08/15
ステータス: OK
クラス: Media
サービス: IntcAzAudAddService

✅ 正常に動作しています

================================================================================
```

## 出力情報の説明

### デバイス情報

| 項目 | 説明 |
|------|------|
| デバイス名 | デバイスの表示名 |
| 製造元 | デバイスの製造元 |
| デバイスID | システム内での一意識別子 |
| ドライバーバージョン | インストールされているドライバーのバージョン |
| ドライバー日付 | ドライバーのリリース日 |
| ステータス | デバイスの現在の動作状態 |
| クラス | デバイスのカテゴリ |
| サービス | 関連するWindowsサービス |

### 状態表示

- **緑色 ✅**: 正常に動作
- **黄色 ⚠️**: 注意が必要（古いドライバー等）
- **赤色 ❌**: エラーまたは重大な問題

### 統計情報

- **デバイスクラス別統計**: Media、AudioEndpoint、SoftwareDevice等
- **ステータス別統計**: OK、エラー、不明等
- **製造元別統計**: Realtek、NVIDIA、Microsoft等

## 問題の種類と対応

### 1. 緊急対応が必要な問題

- デバイスの動作停止
- ドライバーの破損
- ハードウェアエラー

**対応手順:**
1. デバイスマネージャーを開く（Windowsキー + X）
2. 問題のあるデバイスを右クリック
3. 「ドライバーの更新」を選択
4. 「コンピューターを参照してドライバーを検索」
5. 「コンピューター上の利用可能なドライバーの一覧から選択」

### 2. 更新推奨の問題

- 古いドライバー（1年以上前）
- ドライバー情報取得エラー

**対応手順:**
1. Windows Updateを実行
2. 製造元の公式サイトから最新ドライバーをダウンロード
3. デバイスマネージャーからドライバーを更新

## トラブルシューティング

### よくあるエラー

#### "無効なクエリです"
**原因**: DeviceIDに特殊文字が含まれている
**対策**: プログラムが自動的に複数のエスケープ方法を試行します

#### "取得エラー: アクセスが拒否されました"
**原因**: 一部のシステム情報へのアクセス制限
**対策**: 通常は診断に影響しません。詳細情報が必要な場合は管理者権限で実行

#### "Audioデバイスが見つかりませんでした"
**原因**: オーディオデバイスドライバーが正しくインストールされていない
**対策**: デバイスマネージャーで「表示」→「非表示のデバイスの表示」を確認

### 外部ツールの起動

プログラムには外部ツールを起動するヘルパー機能が含まれています：

```csharp
// デバイスマネージャーを開く
ExternalToolHelper.OpenDeviceManager();

// Windows Updateを開く
ExternalToolHelper.OpenWindowsUpdate();
```

## 技術仕様

### 対応デバイスクラス

- **Media**: 標準的なオーディオデバイス
- **AudioEndpoint**: オーディオエンドポイント
- **SoftwareDevice**: ソフトウェアベースのオーディオデバイス

### WMIクエリ

```sql
SELECT * FROM Win32_PnPEntity 
WHERE PNPClass = 'Media' 
   OR Name LIKE '%audio%' 
   OR Name LIKE '%sound%'
```

### エラーコード対応表

| コード | 説明 |
|--------|------|
| 0 | 正常 |
| 1 | 正しく構成されていません |
| 3 | ドライバーが破損している可能性があります |
| 10 | デバイスを開始できません |
| 12 | 空きリソースが不足しています |
| 18 | ドライバーを再インストールしてください |
| 22 | デバイスは無効です |
| 28 | ドライバーがインストールされていません |

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

プロジェクトへの貢献を歓迎します：

1. このリポジトリをフォーク
2. 機能ブランチを作成
3. 変更をコミット
4. プルリクエストを送信

## サポート

問題や質問がある場合は、GitHubのIssuesセクションで報告してください。

## 更新履歴

### v1.0.0
- 初回リリース
- オーディオデバイスの基本診断機能
- 統計情報表示
- 推奨事項の提供

## 関連リンク

- [Microsoft WMI Documentation](https://docs.microsoft.com/en-us/windows/win32/wmisdk/)
- [.NET System.Management](https://docs.microsoft.com/en-us/dotnet/api/system.management)
- [Windows Device Manager](https://support.microsoft.com/en-us/windows/)